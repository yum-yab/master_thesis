#! /usr/bin/bash

HUS_FIELD_NC="/work/ik1017/CMIP6/data/CMIP6/ScenarioMIP/MPI-M/MPI-ESM1-2-LR/ssp126/r10i1p1f1/6hrLev/hus/gn/v20190710/hus_6hrLev_MPI-ESM1-2-LR_ssp126_r10i1p1f1_gn_201501010600-203501010000.nc"
UA_FIELD_NC="/work/ik1017/CMIP6/data/CMIP6/ScenarioMIP/MPI-M/MPI-ESM1-2-LR/ssp126/r10i1p1f1/6hrLev/ua/gn/v20190815/ua_6hrLev_MPI-ESM1-2-LR_ssp126_r10i1p1f1_gn_201501010600-203501010000.nc"
VA_FIELD_NC="/work/ik1017/CMIP6/data/CMIP6/ScenarioMIP/MPI-M/MPI-ESM1-2-LR/ssp126/r10i1p1f1/6hrLev/va/gn/v20190815/va_6hrLev_MPI-ESM1-2-LR_ssp126_r10i1p1f1_gn_201501010600-203501010000.nc"

OUTPUT_FILE="$1"

cdo -selvar,ivtnorm -expr,'ivtnorm=sqrt((1/9.81 * husua)^2 + (1/9.81 * husva)^2)' -vertsum -selvar,husua,husva -expr,'husua=hus*ua; husva=hus*va;' -ml2pl,100000,97500,95000,92500,90000,87500,85000,82500,80000,77500,75000,70000,65000,60000,55000,50000,45000,40000,35000,30000,25000,22500,20000,17500,15000,12500,10000,7000,5000,3000 -merge $HUS_FIELD_NC $VA_FIELD_NC $UA_FIELD_NC $OUTPUT_FILE

